<%= turbo_stream.replace "query-results" do %>
  <div id="query-results">
    <% if @results[:columns].present? %>
      <div class="table-wrapper">
        <table class="table table-striped table-hover table-bordered">
          <thead class="table-dark">
            <tr>
              <% @results[:columns].each do |column| %>
                <th><%= column %></th>
              <% end %>
            </tr>
          </thead>
          <tbody>
            <% @results[:rows].each do |row| %>
              <tr>
                <% row.each do |value| %>
                  <td><%= value %></td>
                <% end %>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
      <div class="mt-3">
        <small class="text-muted">
          <%= pluralize(@results[:rows].size, 'row') %> returned
        </small>
      </div>
    <% elsif @results[:message].present? %>
      <div class="success-message">
        <i class="fas fa-check-circle"></i> <%= @results[:message] %>
      </div>
    <% end %>
  </div>
<% end %>

<%= turbo_stream.update "query", @query %>